<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Android Emergency Simulation</title>
    <style>
        :root {
            --bg-color: #000;
            --accent-green: #8bc34a;
            --accent-red: #ff5252;
            --text-main: #ffffff;
            --text-secondary: #aaa;
        }

        /* –ó–∞–ø—Ä–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤–µ–∑–¥–µ */
        * {
            margin: 0; padding: 0; box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none; -webkit-user-select: none;
        }

        body {
            background-color: var(--bg-color); color: var(--text-main);
            height: 100vh; width: 100vw; overflow: hidden;
            display: flex; justify-content: center;
        }

        .screen { display: none; width: 100%; height: 100%; flex-direction: column; }
        .screen.active { display: flex; }

        /* –ù–ê–°–¢–†–û–ô–ö–ò */
        #settings-screen {
            padding: 30px; overflow-y: auto; max-width: 500px;
            background: #1a1a1a; user-select: auto; -webkit-user-select: auto;
        }
        #settings-screen * { user-select: auto; }

        h2 { margin-bottom: 20px; color: var(--accent-green); }
        .setting-item { margin-bottom: 15px; display: flex; flex-direction: column; }
        .setting-item label { font-size: 11px; color: var(--accent-green); margin-bottom: 5px; text-transform: uppercase; }

        input, select {
            background: #222; border: 1px solid #444; color: white;
            padding: 12px; border-radius: 8px; outline: none; font-size: 16px;
        }

        .file-input-wrapper { margin-top: 10px; display: none; }
        .file-input-wrapper.visible { display: block; }

        .start-btn {
            background: var(--accent-green); color: black; border: none;
            padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer;
            margin-top: 20px; width: 100%; font-size: 18px;
        }

        /* –ò–ù–¢–ï–†–§–ï–ô–° –î–ï–¢–ï–ö–¶–ò–ò */
        #detect-screen { padding: 6vh 8vw; justify-content: space-between; }
        .header-area h1 { font-size: clamp(24px, 4.5vh, 45px); font-weight: 400; margin-bottom: 5px; }
        .header-area p { color: var(--text-secondary); font-size: clamp(14px, 2vh, 20px); }

        .timer-display {
            flex-grow: 1; display: flex; justify-content: center; align-items: center;
            font-size: clamp(100px, 22vh, 250px); font-weight: 300;
            transition: opacity 0.3s;
        }
        .paused .timer-display { opacity: 0.5; animation: blink 1s infinite; }

        @keyframes blink { 50% { opacity: 0.1; } }

        /* –°–õ–ê–ô–î–ï–†–´ */
        .sliders-container { display: flex; flex-direction: column; gap: 2.5vh; padding-bottom: 2vh; }
        .slider-track {
            position: relative; width: 100%; height: 9vh; background: rgba(255,255,255,0.1);
            border-radius: 50px; display: flex; align-items: center; padding: 0 10px; overflow: hidden;
        }
        .slider-text { position: absolute; width: 100%; text-align: center; font-size: 18px; pointer-events: none; }
        .slider-handle {
            position: relative; height: 7.5vh; width: 7.5vh; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 2;
        }
        .handle-green { background: var(--accent-green); color: black; }
        .handle-red { background: var(--accent-red); color: white; }
        .slider-val { margin-left: auto; margin-right: 20px; font-weight: bold; }

        /* –ö–û–ü–ò–†–ê–ô–¢ */
        .copyright {
            text-align: center; font-size: 12px; color: #555;
            padding-bottom: 2vh; user-select: none;
        }
        .copyright a { color: #777; text-decoration: none; pointer-events: auto; }
    </style>
</head>
<body>

    <audio id="main-audio" loop></audio>

    <div id="settings-screen" class="screen active">
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
        <div class="setting-item"><label>–ó–∞–≥–æ–ª–æ–≤–æ–∫</label><input type="text" id="in-title"></div>
        <div class="setting-item"><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><input type="text" id="in-sub"></div>
        <div class="setting-item"><label>–¢–µ–∫—Å—Ç —Å–ª–∞–π–¥–µ—Ä–∞ –û–ö</label><input type="text" id="in-ok-txt"></div>
        <div class="setting-item"><label>–¢–µ–∫—Å—Ç —Å–ª–∞–π–¥–µ—Ä–∞ –û—Ç–º–µ–Ω–∞</label><input type="text" id="in-cancel-txt"></div>
        <div class="setting-item"><label>–í—Ä–µ–º—è (—Å–µ–∫)</label><input type="number" id="in-timer"></div>
        
        <div class="setting-item">
            <label>–ó–≤—É–∫</label>
            <select id="sound-mode" onchange="toggleFileOpener()">
                <option value="default">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (music.mp3)</option>
                <option value="custom">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ–π –∑–≤—É–∫</option>
            </select>
            <div id="file-wrapper" class="file-input-wrapper">
                <input type="file" id="audio-file" accept="audio/*">
            </div>
        </div>

        <button class="start-btn" onclick="saveAndStart()">–ó–ê–ü–£–°–¢–ò–¢–¨</button>
        
        <div class="copyright" style="margin-top: 30px;">
            ¬© I114rk | <a href="mailto:vanyel870@gmail.com">vanyel870@gmail.com</a>
        </div>
    </div>

    <div id="detect-screen" class="screen">
        <div class="header-area">
            <h1 id="out-title"></h1>
            <p id="out-sub"></p>
        </div>
        <div class="timer-display" id="main-timer">30</div>
        
        <div class="sliders-container">
            <div class="slider-track" id="track-ok">
                <div class="slider-handle handle-green" id="handle-ok">‚úì</div>
                <div class="slider-text" id="out-ok-txt"></div>
                <div class="slider-val timer-sync">30</div>
            </div>
            <div class="slider-track" id="track-cancel">
                <div class="slider-handle handle-red" id="handle-cancel">üìû</div>
                <div class="slider-text" id="out-cancel-txt"></div>
                <div class="slider-val timer-sync">30</div>
            </div>
        </div>

        <div class="copyright">
            ¬© I114rk | vanyel870@gmail.com
        </div>
    </div>

    <script>
        let timeLeft;
        let timerInterval;
        let isPaused = false;
        const audio = document.getElementById('main-audio');
        const STORAGE_KEY = 'crash_app_final_settings';

        window.onload = () => {
            const saved = localStorage.getItem(STORAGE_KEY);
            const data = saved ? JSON.parse(saved) : {
                title: "Car crash detected",
                sub: "Google Voice Assistant doesn't work.",
                okTxt: "–Ø –≤ –ø–æ—Ä—è–¥–∫–µ",
                cancelTxt: "–û—Ç–º–µ–Ω–∞ / –í—ã–∑–æ–≤",
                timer: "30",
                soundMode: "default"
            };
            
            document.getElementById('in-title').value = data.title;
            document.getElementById('in-sub').value = data.sub;
            document.getElementById('in-ok-txt').value = data.okTxt;
            document.getElementById('in-cancel-txt').value = data.cancelTxt;
            document.getElementById('in-timer').value = data.timer;
            document.getElementById('sound-mode').value = data.soundMode;
            toggleFileOpener();
        };

        function toggleFileOpener() {
            const mode = document.getElementById('sound-mode').value;
            document.getElementById('file-wrapper').className = (mode === 'custom') ? 'file-input-wrapper visible' : 'file-input-wrapper';
        }

        function saveAndStart() {
            const settings = {
                title: document.getElementById('in-title').value,
                sub: document.getElementById('in-sub').value,
                okTxt: document.getElementById('in-ok-txt').value,
                cancelTxt: document.getElementById('in-cancel-txt').value,
                timer: document.getElementById('in-timer').value,
                soundMode: document.getElementById('sound-mode').value
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));

            if (settings.soundMode === 'custom') {
                const file = document.getElementById('audio-file').files[0];
                if (file) { audio.src = URL.createObjectURL(file); } 
                else { alert("–í—ã–±–µ—Ä–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª"); return; }
            } else { audio.src = 'music.mp3'; }

            startApp(settings);
        }

        function startApp(s) {
            document.getElementById('out-title').innerText = s.title;
            document.getElementById('out-sub').innerText = s.sub;
            document.getElementById('out-ok-txt').innerText = s.okTxt;
            document.getElementById('out-cancel-txt').innerText = s.cancelTxt;
            timeLeft = parseInt(s.timer) || 30;

            document.getElementById('settings-screen').classList.remove('active');
            document.getElementById('detect-screen').classList.add('active');

            audio.play().catch(() => {});
            updateUI();
            runTimer();

            initSlider('handle-ok', 'track-ok', () => end("–û–ö"));
            initSlider('handle-cancel', 'track-cancel', () => end("–í—ã–∑–æ–≤"));
        }

        function runTimer() {
            timerInterval = setInterval(() => {
                if (!isPaused) {
                    timeLeft--;
                    updateUI();
                    if (timeLeft <= 0) { clearInterval(timerInterval); end("–í—Ä–µ–º—è –≤—ã—à–ª–æ!"); }
                }
            }, 1000);
        }

        function togglePause() {
            isPaused = !isPaused;
            if (isPaused) { audio.pause(); document.getElementById('detect-screen').classList.add('paused'); } 
            else { audio.play(); document.getElementById('detect-screen').classList.remove('paused'); }
        }

        window.addEventListener('keydown', (e) => {
            if (e.code === 'KeyK' && document.getElementById('detect-screen').classList.contains('active')) {
                togglePause();
            }
        });

        function updateUI() {
            document.getElementById('main-timer').innerText = timeLeft;
            document.querySelectorAll('.timer-sync').forEach(el => el.innerText = timeLeft);
        }

        function end(msg) {
            clearInterval(timerInterval);
            audio.pause();
            alert(msg);
            location.reload(); 
        }

        function initSlider(handleId, trackId, callback) {
            const handle = document.getElementById(handleId);
            const track = document.getElementById(trackId);
            let isDragging = false;
            let startX = 0;

            const move = (e) => {
                if (!isDragging || isPaused) return;
                let x = (e.type === 'touchmove') ? e.touches[0].clientX : e.clientX;
                let delta = x - startX;
                let max = track.offsetWidth - handle.offsetWidth - 20;
                if (delta < 0) delta = 0;
                if (delta >= max) { isDragging = false; callback(); return; }
                handle.style.transform = `translateX(${delta}px)`;
            };

            const start = (e) => {
                if (isPaused) return;
                isDragging = true;
                startX = (e.type === 'touchstart') ? e.touches[0].clientX : e.clientX;
                handle.style.transition = 'none';
            };

            const stop = () => {
                isDragging = false;
                handle.style.transition = 'transform 0.3s ease';
                handle.style.transform = 'translateX(0px)';
            };

            handle.addEventListener('mousedown', start);
            handle.addEventListener('touchstart', start);
            window.addEventListener('mousemove', move);
            window.addEventListener('touchmove', move, {passive: false});
            window.addEventListener('mouseup', stop);
            window.addEventListener('touchend', stop);
        }
    </script>
</body>
</html>
