<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Android Emergency Simulation</title>
    <style>
        :root {
            --bg-color: #000;
            --accent-green: #8bc34a;
            --accent-red: #ff5252;
            --text-main: #ffffff;
            --text-secondary: #aaa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none; 
            -webkit-user-select: none;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
        }

        .screen { display: none; width: 100%; height: 100%; flex-direction: column; }
        .screen.active { display: flex; }

        /* НАСТРОЙКИ */
        #settings-screen {
            padding: 30px;
            overflow-y: auto;
            max-width: 500px;
            background: #1a1a1a;
            user-select: auto;
            -webkit-user-select: auto;
        }
        #settings-screen * { user-select: auto; }

        .setting-item { margin-bottom: 15px; display: flex; flex-direction: column; }
        .setting-item label { font-size: 11px; color: var(--accent-green); margin-bottom: 5px; text-transform: uppercase; }

        input {
            background: #222; border: 1px solid #444; color: white;
            padding: 12px; border-radius: 8px; outline: none;
            transition: border-color 0.3s;
        }
        input:focus { border-color: var(--accent-green); }

        .start-btn {
            background: var(--accent-green); color: black; border: none;
            padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer;
            margin-top: 10px; font-size: 16px;
        }

        /* ИНТЕРФЕЙС ДЕТЕКЦИИ */
        #detect-screen { padding: 6vh 8vw; justify-content: space-between; }
        .header-area h1 { font-size: clamp(24px, 4.5vh, 45px); font-weight: 400; margin-bottom: 5px; }
        .header-area p { color: var(--text-secondary); font-size: clamp(14px, 2vh, 20px); }

        .timer-display {
            flex-grow: 1; display: flex; justify-content: center; align-items: center;
            font-size: clamp(100px, 22vh, 250px); font-weight: 300;
        }

        /* СЛАЙДЕРЫ */
        .sliders-container { display: flex; flex-direction: column; gap: 2.5vh; padding-bottom: 4vh; }
        .slider-track {
            position: relative; width: 100%; height: 9vh; background: rgba(255,255,255,0.1);
            border-radius: 50px; display: flex; align-items: center; padding: 0 10px; overflow: hidden;
        }
        .slider-text { position: absolute; width: 100%; text-align: center; font-size: 18px; pointer-events: none; }
        .slider-handle {
            position: relative; height: 7.5vh; width: 7.5vh; border-radius: 50%;
            display: flex; justify-content: center; align-items: center; cursor: pointer; z-index: 2;
        }
        .handle-green { background: var(--accent-green); color: black; }
        .handle-red { background: var(--accent-red); color: white; }
        .slider-val { margin-left: auto; margin-right: 20px; font-weight: bold; }

        /* СКРЫТАЯ ПАНЕЛЬ УПРАВЛЕНИЯ */
        #playback-controls {
            position: fixed; bottom: 20px; right: 20px;
            display: flex; gap: 10px; padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px; backdrop-filter: blur(10px);
            opacity: 0; transition: opacity 0.5s ease;
            z-index: 100;
        }
        #playback-controls.visible { opacity: 1; }
        
        .control-btn {
            background: rgba(255,255,255,0.2); border: none; color: white;
            padding: 10px 15px; border-radius: 6px; cursor: pointer; font-size: 14px;
        }
        .control-btn:hover { background: rgba(255,255,255,0.3); }

        #hover-zone { position: fixed; bottom: 0; left: 0; width: 100%; height: 80px; z-index: 99; }
    </style>
</head>
<body>

    <audio id="bg-music" loop><source src="music.mp3" type="audio/mpeg"></audio>

    <div id="settings-screen" class="screen active">
        <h2>Настройки</h2>
        <div class="setting-item"><label>Заголовок</label><input type="text" id="in-title" placeholder="Car crash detected"></div>
        <div class="setting-item"><label>Описание</label><input type="text" id="in-sub" placeholder="Google Voice Assistant doesn't work."></div>
        <div class="setting-item"><label>Текст слайдера ОК</label><input type="text" id="in-ok-txt" placeholder="Я в порядке"></div>
        <div class="setting-item"><label>Текст слайдера Отмена</label><input type="text" id="in-cancel-txt" placeholder="Отмена / Вызов"></div>
        <div class="setting-item"><label>Время (сек)</label><input type="number" id="in-timer" value="30"></div>
        <button class="start-btn" onclick="saveAndStart()">ЗАПУСТИТЬ</button>
        <p style="font-size: 10px; color: #555; margin-top: 15px; text-align: center;">Настройки сохраняются автоматически</p>
        <p>&copy; 2025 I114rk. Все права защищены. По вопросам использования обращайтесь: <a href="mailto:vanyel870@gmail.com">ПОЧТА</a></p>

    </div>

    <div id="detect-screen" class="screen">
        <div class="header-area">
            <h1 id="out-title"></h1>
            <p id="out-sub"></p>
        </div>
        <div class="timer-display" id="main-timer">30</div>
        <div class="sliders-container">
            <div class="slider-track" id="track-ok">
                <div class="slider-handle handle-green" id="handle-ok">✓</div>
                <div class="slider-text" id="out-ok-txt"></div>
                <div class="slider-val timer-sync">30</div>
            </div>
            <div class="slider-track" id="track-cancel">
                <div class="slider-handle handle-red" id="handle-cancel">📞</div>
                <div class="slider-text" id="out-cancel-txt"></div>
                <div class="slider-val timer-sync">30</div>
            </div>
        </div>
    </div>

    <script>
        let timeLeft;
        let timerInterval;
        let isPaused = false;
        let hideTimeout;
        const music = document.getElementById('bg-music');
        const controls = document.getElementById('playback-controls');

        // Ключи для сохранения
        const STORAGE_KEY = 'crash_app_settings';

        // 1. Загрузка настроек при старте
        window.onload = () => {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const data = JSON.parse(saved);
                document.getElementById('in-title').value = data.title || "";
                document.getElementById('in-sub').value = data.sub || "";
                document.getElementById('in-ok-txt').value = data.okTxt || "";
                document.getElementById('in-cancel-txt').value = data.cancelTxt || "";
                document.getElementById('in-timer').value = data.timer || "30";
            } else {
                // Дефолтные значения, если пусто
                document.getElementById('in-title').value = "Car crash detected";
                document.getElementById('in-sub').value = "Google Voice Assistant doesn't work.";
                document.getElementById('in-ok-txt').value = "Я в порядке";
                document.getElementById('in-cancel-txt').value = "Отмена / Вызов";
            }
        };

        // 2. Сохранение и запуск
        function saveAndStart() {
            const settings = {
                title: document.getElementById('in-title').value,
                sub: document.getElementById('in-sub').value,
                okTxt: document.getElementById('in-ok-txt').value,
                cancelTxt: document.getElementById('in-cancel-txt').value,
                timer: document.getElementById('in-timer').value
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));
            startApp(settings);
        }

        function startApp(s) {
            document.getElementById('out-title').innerText = s.title;
            document.getElementById('out-sub').innerText = s.sub;
            document.getElementById('out-ok-txt').innerText = s.okTxt;
            document.getElementById('out-cancel-txt').innerText = s.cancelTxt;
            timeLeft = parseInt(s.timer) || 30;

            document.getElementById('settings-screen').classList.remove('active');
            document.getElementById('detect-screen').classList.add('active');

            music.play().catch(() => console.log("Music blocked by browser. Click anywhere."));
            updateUI();
            startTimer();

            initSlider('handle-ok', 'track-ok', () => end("Вы подтвердили: ОК"));
            initSlider('handle-cancel', 'track-cancel', () => end("Вызов экстренных служб"));
        }

        /* --- Логика управления (Пауза, Таймер, Слайдеры) аналогична предыдущей --- */

        function togglePause() {
            isPaused = !isPaused;
            const btn = document.getElementById('btn-pause-ui');
            if (isPaused) {
                clearInterval(timerInterval);
                music.pause();
                btn.innerText = "Продолжить";
                controls.classList.add('visible');
            } else {
                startTimer();
                music.play();
                btn.innerText = "Пауза";
                showControls();
            }
        }

        window.addEventListener('keydown', (e) => {
            if (e.code === 'KeyK' && document.getElementById('detect-screen').classList.contains('active')) {
                togglePause();
            }
        });

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                updateUI();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    end("Время вышло!");
                }
            }, 1000);
        }

        function updateUI() {
            document.getElementById('main-timer').innerText = timeLeft;
            document.querySelectorAll('.timer-sync').forEach(el => el.innerText = timeLeft);
        }

        function end(msg) {
            clearInterval(timerInterval);
            music.pause();
            alert(msg);
            location.reload(); 
        }

        function showControls() {
            controls.classList.add('visible');
            clearTimeout(hideTimeout);
            hideTimeout = setTimeout(() => { if (!isPaused) controls.classList.remove('visible'); }, 5000);
        }

        window.addEventListener('mousemove', (e) => { if (e.clientY > window.innerHeight * 0.8) showControls(); });

        function initSlider(handleId, trackId, callback) {
            const handle = document.getElementById(handleId);
            const track = document.getElementById(trackId);
            let isDragging = false;
            let startX = 0;

            const onStart = (e) => {
                if (isPaused) return;
                isDragging = true;
                startX = (e.type === 'touchstart') ? e.touches[0].clientX : e.clientX;
                handle.style.transition = 'none';
            };

            const onMove = (e) => {
                if (!isDragging || isPaused) return;
                let currentX = (e.type === 'touchmove') ? e.touches[0].clientX : e.clientX;
                let deltaX = currentX - startX;
                let maxDelta = track.offsetWidth - handle.offsetWidth - 20;
                if (deltaX < 0) deltaX = 0;
                if (deltaX >= maxDelta) { isDragging = false; callback(); return; }
                handle.style.transform = `translateX(${deltaX}px)`;
            };

            const onEnd = () => {
                isDragging = false;
                handle.style.transition = 'transform 0.3s ease';
                handle.style.transform = 'translateX(0px)';
            };

            handle.addEventListener('mousedown', onStart);
            handle.addEventListener('touchstart', onStart);
            window.addEventListener('mousemove', onMove);
            window.addEventListener('touchmove', onMove, {passive: false});
            window.addEventListener('mouseup', onEnd);
            window.addEventListener('touchend', onEnd);
        }
    </script>
</body>

</html>

